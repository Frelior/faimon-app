import{g as I,a as k,d as b}from"./news-hO5gk74f.js";import{e as N,k as v,f as B,g as U,c as r,a as o,h as _,F as y,i as g,u,t as V,z as p,y as m,b as C,r as $,o as l,_ as T}from"./index-KekB3DJ8.js";const D={class:"view-container edit-info"},F={class:"edit-block"},Q={key:0,class:"block-items"},S=["onClick"],q={class:"edit-block"},z={key:0,class:"block-items"},L=["onClick"],M={key:0},j={key:1},A=N({__name:"EditInfoView",setup(G){const c=v([]),d=v(!1),f=v(!1),t=B({news:[],descriptions:[]});U(async()=>{await w()});async function w(){const s=await I();s&&(t.news=s.news,t.descriptions=s.descriptions,console.log(t))}async function x(){f.value=!0;const s=[],n=[];let i=!1;t.news.forEach(e=>{e.id?s.push(p(e)):n.push(p(e))}),t.descriptions.forEach(e=>{e.id?s.push(p(e)):n.push(p(e))}),console.log(s);for(const e of s){const{id:a,...E}=e,{error:h}=await m.from("news").update(E).eq("id",a);if(h){console.error(h),i=!0;return}}if(!i&&n.length){const{error:e}=await m.from("news").insert(n);if(e){console.error(e),i=!0;return}}if(c.value.length&&!i&&await m.from("news").delete().in("id",c.value).then(e=>{if(console.log(e.data),e.error){console.error(e.error),i=!0;return}}),i){d.value=!0;return}c.value=[],await w()}return(s,n)=>{const i=$("QuillEditor");return l(),r("div",D,[o("div",F,[n[2]||(n[2]=o("h3",null,"Блок с описанием",-1)),t.descriptions.length?(l(),r("div",Q,[(l(!0),r(y,null,g(t.descriptions,e=>(l(),r("div",{class:"text-editor",key:e.client_id},[C(i,{theme:"snow",toolbar:"full","content-type":"html",content:e.text,"onUpdate:content":a=>e.text=a},null,8,["content","onUpdate:content"]),o("button",{class:"del-btn",onClick:a=>u(b)(t.descriptions,e,c.value)}," Удалить ",8,S)]))),128))])):_("",!0),o("div",null,[o("button",{class:"add-btn",onClick:n[0]||(n[0]=e=>u(k)(t.descriptions,"description"))}," Добавить ")])]),o("div",q,[n[3]||(n[3]=o("h3",null,"Блок с новостями",-1)),t.news.length?(l(),r("div",z,[(l(!0),r(y,null,g(t.news,e=>(l(),r("div",{class:"text-editor",key:e.client_id},[C(i,{theme:"snow",toolbar:"full","content-type":"html",content:e.text,"onUpdate:content":a=>e.text=a},null,8,["content","onUpdate:content"]),o("button",{class:"del-btn",onClick:a=>u(b)(t.news,e,c.value)}," Удалить ",8,L)]))),128))])):_("",!0),o("div",null,[o("button",{class:"add-btn",onClick:n[1]||(n[1]=e=>u(k)(t.news,"news"))},"Добавить")])]),o("button",{onClick:x},"СОХРАНИТЬ"),f.value&&!d.value?(l(),r("p",M,"Изменения сохранены.")):f.value&&d.value?(l(),r("p",j," Произошла ошибка, изменения НЕ сохранены: "+V(d.value),1)):_("",!0)])}}}),K=T(A,[["__scopeId","data-v-4f7ed3b9"]]);export{K as default};
