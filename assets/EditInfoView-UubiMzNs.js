import{g as I,a as k,d as b}from"./news-mDPPt-S8.js";import{e as N,k as v,f as B,g as U,c as r,a as s,h as _,F as g,i as y,u,t as V,J as p,I as m,r as $,o as a,b as C,_ as T}from"./index-DRxykItq.js";const D={class:"view-container edit-info"},F={class:"edit-block"},Q={key:0,class:"block-items"},S=["onClick"],q={class:"edit-block"},J={key:0,class:"block-items"},L=["onClick"],M={key:0},j={key:1},z=N({__name:"EditInfoView",setup(A){const c=v([]),d=v(!1),f=v(!1),t=B({news:[],descriptions:[]});U(async()=>{await w()});async function w(){const o=await I();o&&(t.news=o.news,t.descriptions=o.descriptions,console.log(t))}async function x(){f.value=!0;const o=[],n=[];let i=!1;t.news.forEach(e=>{e.id?o.push(p(e)):n.push(p(e))}),t.descriptions.forEach(e=>{e.id?o.push(p(e)):n.push(p(e))}),console.log(o);for(const e of o){const{id:l,...E}=e,{error:h}=await m.from("news").update(E).eq("id",l);if(h){console.error(h),i=!0;return}}if(!i&&n.length){const{error:e}=await m.from("news").insert(n);if(e){console.error(e),i=!0;return}}if(c.value.length&&!i&&await m.from("news").delete().in("id",c.value).then(e=>{if(console.log(e.data),e.error){console.error(e.error),i=!0;return}}),i){d.value=!0;return}c.value=[],await w()}return(o,n)=>{const i=$("QuillEditor");return a(),r("div",D,[s("div",F,[n[2]||(n[2]=s("h3",null,"Блок с описанием",-1)),t.descriptions.length?(a(),r("div",Q,[(a(!0),r(g,null,y(t.descriptions,e=>(a(),r("div",{class:"text-editor",key:e.client_id},[C(i,{theme:"snow",toolbar:"full","content-type":"html",content:e.text,"onUpdate:content":l=>e.text=l},null,8,["content","onUpdate:content"]),s("button",{class:"del-btn",onClick:l=>u(b)(t.descriptions,e,c.value)}," Удалить ",8,S)]))),128))])):_("",!0),s("div",null,[s("button",{class:"add-btn",onClick:n[0]||(n[0]=e=>u(k)(t.descriptions,"description"))}," Добавить ")])]),s("div",q,[n[3]||(n[3]=s("h3",null,"Блок с новостями",-1)),t.news.length?(a(),r("div",J,[(a(!0),r(g,null,y(t.news,e=>(a(),r("div",{class:"text-editor",key:e.client_id},[C(i,{theme:"snow",toolbar:"full","content-type":"html",content:e.text,"onUpdate:content":l=>e.text=l},null,8,["content","onUpdate:content"]),s("button",{class:"del-btn",onClick:l=>u(b)(t.news,e,c.value)}," Удалить ",8,L)]))),128))])):_("",!0),s("div",null,[s("button",{class:"add-btn",onClick:n[1]||(n[1]=e=>u(k)(t.news,"news"))},"Добавить")])]),s("button",{class:"save-btn",onClick:x},"СОХРАНИТЬ"),f.value&&!d.value?(a(),r("p",M,"Изменения сохранены.")):f.value&&d.value?(a(),r("p",j," Произошла ошибка, изменения НЕ сохранены: "+V(d.value),1)):_("",!0)])}}}),K=T(z,[["__scopeId","data-v-e3bd2e91"]]);export{K as default};
