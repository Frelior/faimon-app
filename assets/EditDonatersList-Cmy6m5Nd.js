import{e as y,k as r,g as k,c as n,a as s,q as D,t as v,w,u as g,P as C,a5 as V,a6 as E,a7 as L,h as x,F as B,i as U,A as _,E as p,a8 as A,o,_ as N}from"./index-BrWeWG_j.js";const P={class:"view-container edit-info"},S={class:"header-row"},F=["disabled"],I={key:0},M={class:"wrapper"},$={class:"list-container"},q={key:0,class:"empty-msg"},H={class:"block-items"},T={class:"field id-field"},W={class:"value"},j={class:"field input-field"},z=["onUpdate:modelValue"],G={class:"field input-field"},J=["onUpdate:modelValue"],K=["onClick"],O=y({__name:"EditDonatersList",setup(Q){const l=r([]),i=r(!0),d=r(!1),u=async()=>{i.value=!0;try{const t=await V();t&&(l.value=t.donaters.sort((e,a)=>(e.id||0)-(a.id||0)))}catch(t){console.error("Ошибка загрузки:",t)}finally{i.value=!1}},f=()=>{l.value.push({name:"",amount:0})},h=async t=>{const e=l.value[t];if(e?.id){if(!confirm(`Вы точно хотите удалить ${e.name}?`))return;await A(e.id)}l.value.splice(t,1)},b=async()=>{d.value=!0;try{const t=l.value.map(e=>e.name.trim()?e.id?E(e.id,{name:e.name,amount:e.amount}):L(e):Promise.resolve());await Promise.all(t),await u(),alert("Список успешно сохранен!")}catch(t){console.error("Ошибка при сохранении:",t),alert("Произошла ошибка при сохранении")}finally{d.value=!1}};return k(()=>{u()}),(t,e)=>(o(),n("div",P,[s("div",S,[e[0]||(e[0]=s("div",null,[s("h2",null,"Редактор донатеров"),s("p",null,"Сумма влияет на размер никнейма")],-1)),s("button",{class:"save-btn",onClick:b,disabled:d.value||i.value},v(d.value?"Сохранение...":"Сохранить изменения"),9,F)]),i.value?(o(),n("div",I,"Загрузка...")):(o(),D(g(C),{key:1,class:"scrollbar-root",options:{scrollbars:{autoHide:"scroll"}}},{default:w(()=>[s("div",M,[s("div",$,[l.value.length===0?(o(),n("div",q," Список пуст. Добавьте первого донатера. ")):x("",!0),s("div",H,[(o(!0),n(B,null,U(l.value,(a,m)=>(o(),n("div",{key:a.id||m,class:"edit-block"},[s("div",T,[e[1]||(e[1]=s("span",{class:"label"},"ID:",-1)),s("span",W,v(a.id?a.id:"NEW"),1)]),s("div",j,[e[2]||(e[2]=s("label",null,"Имя:",-1)),_(s("input",{type:"text","onUpdate:modelValue":c=>a.name=c,placeholder:"Имя"},null,8,z),[[p,a.name]])]),s("div",G,[e[3]||(e[3]=s("label",null,"Сумма:",-1)),_(s("input",{type:"number","onUpdate:modelValue":c=>a.amount=c,placeholder:"0"},null,8,J),[[p,a.amount]])]),s("button",{class:"del-btn",onClick:c=>h(m)},"✖",8,K)]))),128))]),s("button",{class:"add-btn",onClick:f},"+ Добавить запись")])])]),_:1}))]))}}),X=N(O,[["__scopeId","data-v-ad4bc42b"]]);export{X as default};
